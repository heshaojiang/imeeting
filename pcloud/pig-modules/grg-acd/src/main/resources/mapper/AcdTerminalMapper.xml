<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.grgbanking.grgacd.mapper.AcdTerminalMapper">

    <!-- 开启二级缓存 -->
    <!--<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/>-->

    <resultMap id="resultMap" type="com.grgbanking.grgacd.model.AcdTerminal">
        <id column="id" property="id"></id>
        <result column="terminal_no" property="terminalNo"/>
        <result column="name" property="name"/>
        <result column="access_type" property="accessType"/>
        <result column="access_time" property="accessTime"/>
        <result column="description" property="desc"/>
        <result column="model" property="model"/>
        <result column="machine_code" property="machineCode"/>
        <result column="enable" property="enable"/>
        <result column="status" property="status"/>
        <result column="terminal_ip" property="terminalIp"/>
        <result column="created_time" property="createdTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="del_time" property="delTime"/>
        <result column="del_flag" property="delFlag"/>
    </resultMap>

    <sql id="selectSql">
        SELECT * FROM acd_terminal
    </sql>

    <select id="selectTerminalPage" resultMap="resultMap">
      <include refid="selectSql"/>
        <where>
            del_flag=0
            <if test="terminalNo != null and terminalNo != ''">
                AND terminal_no = #{terminalNo}
            </if>
            <if test="name != null and name != ''">
                AND name LIKE CONCAT('%',#{name},'%')
            </if>
            <if test="accessType != null and accessType != ''">
                access_type = #{accessType}
            </if>
            <if test="keyword != null and keyword != ''">
                <!--bind 标签的两个属性都是必选项， name 为绑定到上下文的变量名,value为OGNL表达式。-->
                <bind name="pattern" value="'%' + keyword + '%'"/>
                <choose>
                    <when test="_databaseId=='mysql'">
                        AND CONCAT( IFNULL(terminal_no,''),IFNULL(name,'') )
                    </when>
                    <when test="_databaseId=='oracle'">
                        AND CONCAT( nvl(terminal_no,''),nvl(name,'') )
                    </when>
                </choose>
                LIKE #{pattern}
            </if>
        </where>

    </select>

</mapper>
